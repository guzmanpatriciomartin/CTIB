<template>
  <div id="exploits" class="card mb-4 animate__animated animate__fadeIn">
    <div class="card-header">
      <h2>Exploits Publicados</h2>
    </div>
    <div class="card-body">
      <p class="text-muted">
        Los exploits son puertas traseras que los atacantes pueden utilizar permitiendo el robo de datos, 
        la instalación de malware, la toma de control de sistemas y múltiples ataques a sistemas informáticos. 
        Al comprender estos exploits, la amenaza que representan y cómo funcionan, las empresas pueden tomar 
        medidas proactivas para protegerse de ataques cibernéticos.
      </p>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Exploit</th>
            <th>Tipo</th>
            <th>Plataforma</th>
            <th>Enlace</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(exploit, index) in exploitsLocales" :key="index">
            <td>{{ exploit.fecha }}</td>
            <td>{{ exploit.nombre }}</td>
            <td>{{ exploit.tipo }}</td>
            <td>{{ exploit.plataforma }}</td>
            <td>
              <a v-if="exploit.link" 
                :href="exploit.link" 
                target="_blank" 
                rel="noopener noreferrer" 
                class="exploit-link">
                <i class="fas fa-external-link-alt"></i>
                <span class="link-text">Ver detalles</span>
              </a>
              <span v-else class="text-muted">N/A</span>
            </td>
          </tr>
        </tbody>
      </table>
      <div class="alert alert-secondary mt-3">
        <em>Clasificación: TLP:CLEAR | La información contenida en este informe puede ser compartida sin restricción.</em>
      </div>
    </div>
  </div>
</template>

<script>
export default {
  props: {
    exploits: {
      type: Array,
      required: true,
      default: () => [
        {
          fecha: '28/02',
          nombre: 'XSS en Label Studio',
          tipo: 'Network',
          plataforma: 'Label Studio',
          link: 'https://example.com/xss-label-studio'
        },
        {
          fecha: '28/02',
          nombre: 'RCE en FortiManager 7.6.0',
          tipo: 'Remote Code',
          plataforma: 'Fortinet',
          link: 'https://example.com/rce-fortimanager'
        }
      ]
    }
  },
  data() {
    return {
      exploitsLocales: this.exploits.map(exploit => ({
        ...exploit,
        link: exploit.link ? this.formatLink(exploit.link) : null
      }))
    }
  },
  watch: {
    exploits: {
      handler(newExploits) {
        this.exploitsLocales = newExploits.map(exploit => ({
          ...exploit,
          link: exploit.link ? this.formatLink(exploit.link) : null
        }))
      },
      deep: true
    }
  },
  methods: {
    formatLink(link) {
      if (!link.startsWith('http://') && !link.startsWith('https://')) {
        return `https://${link}`
      }
      return link
    }
  }
}
</script>

<style scoped>
.card {
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.card-header {
  background-color: #f8f9fa;
  border-bottom: 1px solid #eaeaea;
  padding: 1rem 1.5rem;
}

.card-header h2 {
  margin: 0;
  font-size: 1.5rem;
  color: #333;
}

.card-body {
  padding: 1.5rem;
}

.table {
  width: 100%;
  margin-bottom: 1rem;
  color: #212529;
  border-collapse: collapse;
}

.table th,
.table td {
  padding: 0.75rem;
  vertical-align: top;
  border-top: 1px solid #dee2e6;
}

.table thead th {
  vertical-align: bottom;
  border-bottom: 2px solid #dee2e6;
  background-color: #f8f9fa;
}

.table-striped tbody tr:nth-of-type(odd) {
  background-color: rgba(0, 0, 0, 0.05);
}

.alert {
  padding: 0.75rem 1.25rem;
  margin-bottom: 1rem;
  border: 1px solid transparent;
  border-radius: 0.25rem;
}

.alert-secondary {
  color: #383d41;
  background-color: #e2e3e5;
  border-color: #d6d8db;
}

.exploit-link {
  color: #2c3e50;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  transition: all 0.2s ease;
  background: rgba(44, 62, 80, 0.05);
}

.exploit-link:hover {
  background: rgba(44, 62, 80, 0.1);
  text-decoration: none;
}

.link-text {
  font-size: 0.9em;
}

.fa-external-link-alt {
  font-size: 0.8em;
}

/* Dark mode */
.dark-mode .card {
  background-color: #2d2d2d;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.dark-mode .card-header {
  background-color: #1e1e1e;
  border-bottom-color: #444;
}

.dark-mode .card-header h2 {
  color: #f0f0f0;
}

.dark-mode .table {
  color: #f0f0f0;
}

.dark-mode .table th,
.dark-mode .table td {
  border-top-color: #444;
}

.dark-mode .table thead th {
  border-bottom-color: #444;
  background-color: #1e1e1e;
}

.dark-mode .table-striped tbody tr:nth-of-type(odd) {
  background-color: rgba(255, 255, 255, 0.05);
}

.dark-mode .alert-secondary {
  color: #e2e3e5;
  background-color: #3d3d3d;
  border-color: #555;
}

.dark-mode .exploit-link {
  color: #f0f0f0;
  background: rgba(255, 255, 255, 0.05);
}

.dark-mode .exploit-link:hover {
  background: rgba(255, 255, 255, 0.1);
}
</style>